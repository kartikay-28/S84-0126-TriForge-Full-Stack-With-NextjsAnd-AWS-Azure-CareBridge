generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String          @id @default(cuid())
  email              String          @unique
  name               String
  password           String
  role               Role
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  profileLevel       Int             @default(0)
  receivedAccess     AccessGrant[]   @relation("DoctorGrants")
  grantedAccess      AccessGrant[]   @relation("PatientGrants")
  doctorAssignments  Assignment[]    @relation("DoctorAssignments")
  patientAssignments Assignment[]    @relation("PatientAssignments")
  doctorProfile      DoctorProfile?
  medicalRecords     MedicalRecord[]
  patientProfile     PatientProfile?
  sentMessages       Message[]       @relation("MessageSender")
  receivedMessages   Message[]       @relation("MessageReceiver")
  healthMetrics      HealthMetric[]

  @@map("users")
}

model PatientProfile {
  id                           String                  @id @default(cuid())
  userId                       String                  @unique
  age                          Int?
  gender                       Gender?
  symptoms                     String[]
  consultationPreference       ConsultationPreference?
  medicalHistory               String[]
  currentMedications           String[]
  emergencyContactName         String?
  emergencyContactPhone        String?
  vitalsBp                     String?
  vitalsSugar                  String?
  vitalsHeartRate              Int?
  vitalsOxygen                 Int?
  createdAt                    DateTime                @default(now())
  updatedAt                    DateTime                @updatedAt
  primaryProblem               MedicalCondition?
  emergencyContactRelationship String?
  lifestyleDrinking            String?
  lifestyleExercise            String?
  lifestyleSmoking             String?
  user                         User                    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("patient_profiles")
}

model DoctorProfile {
  id                String            @id @default(cuid())
  userId            String            @unique
  specialization    String?
  experienceYears   Int?
  conditionsTreated String[]
  consultationMode  ConsultationMode?
  availability      String?
  qualifications    String[]
  clinicName        String?
  clinicAddress     String?
  clinicPhone       String?
  consultationFee   Float?
  languagesSpoken   String[]
  licenseDocument   String?
  bio               String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("doctor_profiles")
}

model Assignment {
  id         String   @id @default(cuid())
  patientId  String
  doctorId   String
  assignedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  doctor     User     @relation("DoctorAssignments", fields: [doctorId], references: [id], onDelete: Cascade)
  patient    User     @relation("PatientAssignments", fields: [patientId], references: [id], onDelete: Cascade)

  @@unique([patientId, doctorId])
  @@map("assignments")
}

model AccessGrant {
  id          String            @id @default(cuid())
  patientId   String
  doctorId    String
  grantedAt   DateTime?
  expiresAt   DateTime?
  requestedAt DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  createdAt   DateTime          @default(now())
  status      AccessGrantStatus @default(PENDING)
  doctor      User              @relation("DoctorGrants", fields: [doctorId], references: [id], onDelete: Cascade)
  patient     User              @relation("PatientGrants", fields: [patientId], references: [id], onDelete: Cascade)

  @@unique([patientId, doctorId], name: "patientId_doctorId")
  @@map("access_grants")
}

model MedicalRecord {
  id          String     @id @default(cuid())
  title       String
  description String?
  recordType  RecordType
  fileName    String
  fileUrl     String
  fileSize    Int
  mimeType    String
  patientId   String
  uploadedAt  DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  createdAt   DateTime   @default(now())
  patient     User       @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("medical_records")
}

enum Role {
  PATIENT
  DOCTOR
}

enum AccessGrantStatus {
  PENDING
  APPROVED
  DENIED
  REVOKED
}

enum RecordType {
  LAB_RESULTS
  PRESCRIPTION
  IMAGING
  CONSULTATION
  OTHER
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum ConsultationPreference {
  IN_PERSON
  VIDEO_CALL
  PHONE_CALL
  CHAT
}

enum ConsultationMode {
  IN_PERSON_ONLY
  ONLINE_ONLY
  BOTH
}

enum MedicalCondition {
  HEART_DISEASE
  DIABETES
  HYPERTENSION
  ASTHMA
  ARTHRITIS
  DEPRESSION
  ANXIETY
  SKIN_CONDITIONS
  DIGESTIVE_ISSUES
  HEADACHES_MIGRAINES
  BACK_PAIN
  ALLERGIES
  RESPIRATORY_ISSUES
  KIDNEY_DISEASE
  LIVER_DISEASE
  THYROID_DISORDERS
  CANCER
  NEUROLOGICAL_DISORDERS
  MENTAL_HEALTH
  WOMENS_HEALTH
  MENS_HEALTH
  PEDIATRIC_CARE
  GERIATRIC_CARE
  GENERAL_CHECKUP
  PREVENTIVE_CARE
  OTHER
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  createdAt  DateTime @default(now())

  sender   User @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@map("messages")
}

model HealthMetric {
  id         String   @id @default(cuid())
  patientId  String
  type       String
  value      String
  recordedAt DateTime @default(now())

  patient User @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@map("health_metrics")
}
